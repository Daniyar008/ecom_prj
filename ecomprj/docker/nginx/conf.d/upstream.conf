# =============================================================================
# Upstream Health Check Configuration (for Nginx Plus or alternatives)
# =============================================================================
# /docker/nginx/conf.d/upstream.conf

# Django Backend Servers
upstream django_backend {
    # Load balancing method
    least_conn;
    
    # Backend servers
    server web:8000 weight=5 max_fails=3 fail_timeout=30s;
    
    # Keepalive connections to backend
    keepalive 32;
    keepalive_requests 1000;
    keepalive_timeout 60s;
}

# For multiple backend replicas (production)
# upstream django_backend {
#     least_conn;
#     server web-1:8000 weight=5;
#     server web-2:8000 weight=5;
#     server web-3:8000 weight=5;
#     keepalive 64;
# }

# Redis cache backend (if using Redis as cache proxy)
upstream redis_backend {
    server redis:6379;
    keepalive 10;
}
